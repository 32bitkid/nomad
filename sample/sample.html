<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<title></title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
	<script src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
	<script>
		$(function () {
			$.get("trails", onTrails, 'json')

			function onTrails(trails, status) {
				var trail = trails[0]
				$('#name').text(trail.name)
				$('#description').text(trail.description)

				$.get(trail.points.href, onPoints, 'json')
			}

			function onPoints(points, status) {
				var first = points[0], last = points[points.length - 1]
				var bounds = new google.maps.LatLngBounds(
					new google.maps.LatLng(
						Math.min(first.lat, last.lat),
						Math.min(first.long, last.long)
					),
					new google.maps.LatLng(
						Math.max(first.lat, last.lat),
						Math.max(first.long, last.long)
					)
				)
				var center = new google.maps.LatLng(
					0.5 * (first.lat + last.lat),
					0.5 * (first.long + last.long)
				)
				var options = {
					zoom: 4,
					center: center,
					mapTypeId: google.maps.MapTypeId.TERRAIN
				}
				var canvas = $('#map-canvas')
				var map = new google.maps.Map(canvas.get(0), options)
				map.fitBounds(bounds)

				var polyline = {
					path: [],
					strokeColor: '#FF0000',
					strokeOpacity: 1.0,
					strokeWeight: 2
				}
				$.each(points, function (index, point) {
					polyline.path.push(new google.maps.LatLng(point.lat, point.long))
				})
				new google.maps.Polyline(polyline).setMap(map)
			}
		})
	</script>
	<style>
		#map-canvas {
			height: 650px;
		}
	</style>
</head>
<body>
	<h1 id=name></h1>
	<div id=description></div>
	<div id="map-canvas"></div>
</body>
</html>